(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{665:function(t,s,e){"use strict";e.r(s);var a=e(44),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"apps-auth"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#apps-auth"}},[t._v("#")]),t._v(" Apps & Auth")]),t._v(" "),e("p",[t._v("This post was originally part of the Making Speckle 2.0 series of posts on the community forum, it's been adapted as part of our dev docs. Check out "),e("a",{attrs:{href:"https://speckle.community/t/apps-authn-speckle-2-0/961",target:"_blank",rel:"noopener noreferrer"}},[t._v("the original on our forum"),e("OutboundLink")],1),t._v("!")]),t._v(" "),e("h2",{attrs:{id:"introduction"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#introduction"}},[t._v("#")]),t._v(" Introduction")]),t._v(" "),e("p",[t._v("This is a quick post on how authentication with the server works; we've put in "),e("em",[t._v("a lot")]),t._v(" of effort to make it easier for developers to extend the functionality of Speckle in their own apps, and simultaneously more secure for end users.")]),t._v(" "),e("p",[t._v("Before we start, we'd like to clarify that this post refers to specifically "),e("strong",[t._v("authentication")]),t._v(", and not authorization.")]),t._v(" "),e("ul",[e("li",[t._v("Authorization (authZ) controls "),e("strong",[t._v("who has access to what resource")]),t._v("; it's not the focus of this post.")]),t._v(" "),e("li",[t._v("Authentication (authN) controls "),e("strong",[t._v("how a user can delegate access to other applications")]),t._v(" (pieces of software) that then act on their behalf.")])]),t._v(" "),e("h2",{attrs:{id:"api-tokens"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#api-tokens"}},[t._v("#")]),t._v(" API Tokens")]),t._v(" "),e("p",[t._v("All access to the API is done through bearer tokens that need to present in the Authorization header of each request. There are several ways to create/obtain these tokens, which we'll describe below. First, a few important notes on "),e("em",[t._v("tokens in general")]),t._v(":")]),t._v(" "),e("h3",{attrs:{id:"token-scopes"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#token-scopes"}},[t._v("#")]),t._v(" Token Scopes")]),t._v(" "),e("p",[t._v("Each token has a set of associated scopes to it which "),e("strong",[t._v("limit what actions it can do")]),t._v(". For example, you could have a token that is only allowed to read streams and your profile information. Alternatively, you could have a token that is allowed to search for other users on the server, read your existing streams, create new ones, etc.")]),t._v(" "),e("p",[t._v("As Speckle will grow with functionality, new scopes will be made available. Currently there are:")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" coreModuleScopes "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    name"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"server:setup"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    description"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Edit server information."')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    name"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tokens:read"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    description"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token template-string"}},[e("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("Access your api tokens.")]),e("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    name"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tokens:write"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    description"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token template-string"}},[e("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("Create and delete api tokens on your behalf.")]),e("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    name"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"streams:read"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    description"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Read your streams & and any associated information (branches, tags, comments, objects, etc.)"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    name"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"streams:write"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    description"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Create streams on your behalf and read your streams & any associated information (any associated information (branches, tags, comments, objects, etc.)"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    name"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"profile:read"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    description"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token template-string"}},[e("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("Read your profile information")]),e("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    name"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"profile:email"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    description"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token template-string"}},[e("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("Access your email.")]),e("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    name"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"users:read"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    description"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token template-string"}},[e("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("Read other users' profile on your behalf.")]),e("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    name"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"users:email"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    description"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access the emails of other users."')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br"),e("span",{staticClass:"line-number"},[t._v("17")]),e("br"),e("span",{staticClass:"line-number"},[t._v("18")]),e("br"),e("span",{staticClass:"line-number"},[t._v("19")]),e("br"),e("span",{staticClass:"line-number"},[t._v("20")]),e("br"),e("span",{staticClass:"line-number"},[t._v("21")]),e("br"),e("span",{staticClass:"line-number"},[t._v("22")]),e("br"),e("span",{staticClass:"line-number"},[t._v("23")]),e("br"),e("span",{staticClass:"line-number"},[t._v("24")]),e("br"),e("span",{staticClass:"line-number"},[t._v("25")]),e("br"),e("span",{staticClass:"line-number"},[t._v("26")]),e("br"),e("span",{staticClass:"line-number"},[t._v("27")]),e("br"),e("span",{staticClass:"line-number"},[t._v("28")]),e("br"),e("span",{staticClass:"line-number"},[t._v("29")]),e("br"),e("span",{staticClass:"line-number"},[t._v("30")]),e("br"),e("span",{staticClass:"line-number"},[t._v("31")]),e("br"),e("span",{staticClass:"line-number"},[t._v("32")]),e("br"),e("span",{staticClass:"line-number"},[t._v("33")]),e("br"),e("span",{staticClass:"line-number"},[t._v("34")]),e("br"),e("span",{staticClass:"line-number"},[t._v("35")]),e("br"),e("span",{staticClass:"line-number"},[t._v("36")]),e("br"),e("span",{staticClass:"line-number"},[t._v("37")]),e("br"),e("span",{staticClass:"line-number"},[t._v("38")]),e("br"),e("span",{staticClass:"line-number"},[t._v("39")]),e("br"),e("span",{staticClass:"line-number"},[t._v("40")]),e("br")])]),e("h3",{attrs:{id:"token-lifetime"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#token-lifetime"}},[t._v("#")]),t._v(" Token Lifetime")]),t._v(" "),e("p",[t._v("Tokens also have a certain lifetime after which they're no longer valid. This helps with automatically blocking access to long forgotten apps. Written a little script two years ago that you've totally forgot about, but the token's nicely pasted in the codebase since you've never published it? Well, now that's safe even if someone else somehow snitches it - it probably expired.")]),t._v(" "),e("h2",{attrs:{id:"personal-access-tokens"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#personal-access-tokens"}},[t._v("#")]),t._v(" Personal Access Tokens")]),t._v(" "),e("p",[t._v("As a developer, you can now create personal access tokens that you can use to delegate access to your script on your behalf, similar to how Github's "),e("a",{attrs:{href:"https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token",target:"_blank",rel:"noopener noreferrer"}},[t._v("Personal Access Tokens"),e("OutboundLink")],1),t._v(" work.")]),t._v(" "),e("p",[t._v("When you create them, you can assign assign to them whatever scopes & lifetime you want to, just remember to limit both to the minimum to be "),e("em",[t._v("safe.")])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("To create a new token head over "),e("code",[t._v("YOUR-SPECKLE-SERVER\\profile")])])]),t._v(" "),e("h2",{attrs:{id:"apps"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#apps"}},[t._v("#")]),t._v(" Apps")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://user-images.githubusercontent.com/2679513/109046703-f45be080-76cc-11eb-83b3-27ed956ff319.png",alt:""}})]),t._v(" "),e("p",[t._v("Once you're beyond the hacking phase, you'll probably want to create & publish a speckle app that others can use. As a developer, you can:")]),t._v(" "),e("ul",[e("li",[t._v("register apps that others can use (or not),")]),t._v(" "),e("li",[t._v("manage the apps you have created - edit name, description, redirect url, scopes, and delete.")])]),t._v(" "),e("p",[t._v("Once an app is registered on a server, users can now delegate access to it for the set of scopes that the developer registered for that application. Once the delegation process is successful - the user approves it - they will get redirected to the url that the developer specified.")]),t._v(" "),e("p",[t._v("Of course, as an end user, you have full control and visibility on the apps you have authorized. You can:")]),t._v(" "),e("ul",[e("li",[t._v("see all your authorized apps (apps that you have granted access to),")]),t._v(" "),e("li",[t._v("revoke access to any of the above,")]),t._v(" "),e("li",[t._v("check out any publicly listed apps on this server (optional at this stage)")])]),t._v(" "),e("h3",{attrs:{id:"extras-on-app-types"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#extras-on-app-types"}},[t._v("#")]),t._v(" Extras on app types:")]),t._v(" "),e("p",[t._v("Note: broadly speaking, there are two type of apps:")]),t._v(" "),e("ul",[e("li",[t._v("Apps that act on behalf of a user - "),e("strong",[t._v("supported ✅")])]),t._v(" "),e("li",[t._v("Apps that can act with their own identity - "),e("strong",[t._v("not currently supported ⏱")])])]),t._v(" "),e("p",[t._v("We'll write soon more documentation on how the authentication flow with the Server actually works. For the geeks out there, here's a short summary, or some important points:")]),t._v(" "),e("ul",[e("li",[t._v("We are supporting the "),e("strong",[t._v("authorization_code")]),t._v(" flow with "),e("strong",[t._v("PCKE")]),t._v(" only for public and confidential clients.")]),t._v(" "),e("li",[t._v("We do not support dynamic scope requests for apps. We "),e("strong",[t._v("only support pre-registered scopes for each app")]),t._v(".")]),t._v(" "),e("li",[t._v("If an app is edited in any way - name, scopes, etc. - all its tokens get revoked and users will need to re-authorize it.")])]),t._v(" "),e("p",[t._v("Clients are usually split into two categories: public and private. Public clients cannot realistically hold a secret, whereas private ones can. For example, a front-end only web application is a public client; same goes for the desktop connectors. A private client can be a server-side application, which can realistically store an application secret in, for example, a .env file or provide it during the CI/CD process.")]),t._v(" "),e("p",[t._v("Clients are protected by:")]),t._v(" "),e("ul",[e("li",[t._v("Using exclusively a pre-registered redirect URL.")]),t._v(" "),e("li",[t._v("Native apps (desktop): registering a custom application scheme ("),e("code",[t._v("speckle://")]),t._v(").")]),t._v(" "),e("li",[t._v("PKCE (Proof of Key For Code Exchange).")]),t._v(" "),e("li",[t._v("a client id & client secret, but the clientSecret is superfluous in the case of public clients.")])]),t._v(" "),e("h2",{attrs:{id:"examples"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#examples"}},[t._v("#")]),t._v(" Examples")]),t._v(" "),e("p",[t._v("The 2.0 server already comes with two applications that demonstrate this flow (warning - there might still be bugs). These are:")]),t._v(" "),e("ul",[e("li",[t._v("The main web frontend application - accessible at the server's default url, and")]),t._v(" "),e("li",[t._v("The GraphQL explorer - accessible at your server's url + "),e("code",[t._v("/explorer")]),t._v(".")])]),t._v(" "),e("h2",{attrs:{id:"summary"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#summary"}},[t._v("#")]),t._v(" Summary")]),t._v(" "),e("p",[t._v("We've put a lot of work into making Speckle developer friendly and extensible - and apps are just a small part of that. We hope that writing Speckle Apps will be fun and effective, and we can't wait to see what you'll do with them!")])])}),[],!1,null,null,null);s.default=n.exports}}]);